# 微信公众号文章发布 Skill 使用指南

> 一键将 Markdown 文章发布到微信公众号草稿箱，告别繁琐的复制粘贴排版流程。

**v1.0.0** — 基于 API 的发布方式，稳定高效

---

## 目录

1. [解决的痛点](#1-解决的痛点)
2. [解决方案](#2-解决方案)
3. [执行方式](#3-执行方式)
4. [完整示例](#4-完整示例)
5. [常见问题](#5-常见问题)
6. [更新日志](#6-更新日志)

---

## 1. 解决的痛点

### 1.1 微信公众号是什么？

微信公众号是微信平台上的内容发布工具，允许个人和企业发布文章、图文消息等内容给订阅者。文章支持：

- 富文本格式（标题、粗体、引用等）
- 多张图片嵌入
- 超链接
- 音视频

管理后台：https://mp.weixin.qq.com

### 1.2 手动发布的痛点

如果你习惯用 Markdown 写作，将内容发布到微信公众号是一个**极其繁琐**的过程：

#### 痛点一：格式无法直接粘贴

```
从 Markdown 编辑器复制内容 -> 粘贴到公众号编辑器 -> 格式全部丢失
```

公众号编辑器不支持 Markdown，你需要**逐一手动设置**每个格式：
- 选中文字 -> 点击 H2 按钮
- 选中文字 -> 点击粗体按钮
- 选中文字 -> 点击链接按钮 -> 粘贴 URL

一篇包含 5 个小节、10 处加粗、8 个链接的文章，格式设置可能需要 **15-20 分钟**。

#### 痛点二：图片上传效率低下

公众号的图片上传流程：

```
进入素材管理 -> 上传图片 -> 返回编辑器 -> 插入图片 -> 调整位置
```

每张图片需要**多次点击 + 文件选择 + 等待上传**。一篇包含 5 张图片的文章，仅图片插入就需要 **5-10 分钟**。

#### 痛点三：多平台切换

发布一篇文章需要在以下界面之间反复切换：
1. Markdown 编辑器
2. 公众号素材库（上传图片）
3. 公众号文章编辑器

### 1.3 时间成本对比

| 操作 | 手动方式 | 使用本 Skill |
|------|----------|--------------|
| 格式转换 | 15-20 分钟 | 0（自动） |
| 图片上传 | 5-10 分钟 | 0（自动） |
| 复制粘贴内容 | 2-3 分钟 | 0（自动） |
| 总计 | **20-30 分钟** | **< 1 分钟** |

**效率提升：30 倍以上**

---

## 2. 解决方案

### 2.1 技术架构

本 Skill 通过 API 直接与微信服务器通信，无需浏览器自动化：

```
┌─────────────────┐
│   Markdown 文件  │
└────────┬────────┘
         │ Python 解析
         v
┌─────────────────┐
│  结构化数据       │
│  - title        │
│  - content      │
│  - images       │
└────────┬────────┘
         │ WeChat API
         v
┌─────────────────┐
│  公众号草稿箱     │
│  (自动保存)      │
└─────────────────┘
```

#### 核心组件

| 组件 | 作用 |
|------|------|
| `wechat_api.py` | 微信 API 客户端，处理认证和请求 |
| `parse_markdown.py` | 解析 Markdown，提取标题和内容 |
| Claude Code | 协调整个流程 |

### 2.2 工作流程

本 Skill 采用 **API 优先** 策略，简单高效：

```
Step 1: 检查 API Key
        |
        v
Step 2: 获取公众号列表
        |
        v
Step 3: 解析 Markdown 文件
        |
        v
Step 4: 调用发布 API
        |
        v
Step 5: 报告结果
```

### 2.3 关键技术优势

#### 优势一：基于 API，稳定可靠

传统方式依赖浏览器自动化，容易因页面变化而失效。本 Skill 直接调用 API：

- 不受页面 UI 变化影响
- 执行速度快（无需等待页面加载）
- 错误提示清晰

#### 优势二：跨平台支持

| 平台 | 支持状态 |
|------|----------|
| macOS | ✓ |
| Linux | ✓ |
| Windows | ✓ |

无需安装特殊依赖，标准 Python 即可运行。

#### 优势三：图片自动处理

- 支持本地图片路径
- 支持网络图片 URL
- 自动上传到微信服务器

### 2.4 支持的 Markdown 格式

| Markdown 语法 | 效果 |
|--------------|------|
| `# H1` | 文章标题（自动提取） |
| `## H2` | 二级标题 |
| `### H3` | 三级标题 |
| `**粗体**` | **粗体文字** |
| `*斜体*` | *斜体文字* |
| `[链接](url)` | 超链接 |
| `> 引用` | 引用块 |
| `- 列表` | 无序列表 |
| `1. 列表` | 有序列表 |
| `![](img.jpg)` | 图片 |

### 2.5 文章类型

#### news（普通文章）
标准的公众号文章格式，支持完整的富文本内容。

#### newspic（小绿书）
以图片为主的内容格式，类似小红书：
- 最多 20 张图片
- 文字限制 1000 字
- 适合图片为主的内容

### 2.6 安全设计

**绝不自动发布**：本 Skill 仅将内容保存为草稿，最终发布需要用户手动确认。

```
自动完成：上传、格式化、保存草稿
不会执行：点击"发布"按钮
```

这确保用户可以在发布前：
- 预览最终效果
- 检查格式是否正确
- 修改任何需要调整的内容

---

## 3. 执行方式

### 3.1 前置条件

#### 条件一：获取 API Key

1. 访问 [wx.limyai.com](https://wx.limyai.com)
2. 注册账号
3. 授权你的微信公众号
4. 在控制台获取 API Key

#### 条件二：配置环境变量

```bash
# 复制示例文件
cp .env.example .env

# 编辑 .env 文件
WECHAT_API_KEY=your_api_key_here
```

#### 条件三：安装本 Skill

**方式 A：Git Clone（推荐）**

```bash
git clone https://github.com/iamzifei/wechat-article-publisher-skill.git
cp -r wechat-article-publisher-skill/skills/wechat-article-publisher ~/.claude/skills/
```

### 3.2 触发指令

安装完成后，在 Claude Code 中使用以下方式触发：

#### 方式一：自然语言

```
把 /path/to/article.md 发布到微信公众号
```

```
帮我把这篇文章发到公众号：~/Documents/my-article.md
```

```
Publish ~/blog/post.md to WeChat
```

#### 方式二：Skill 命令

```
/wechat-article-publisher /path/to/article.md
```

### 3.3 操作流程

触发后，Claude 会自动执行以下步骤：

```
[1/4] 检查 API Key...
      -> 从 .env 加载 WECHAT_API_KEY
      -> 验证 Key 有效性

[2/4] 获取公众号列表...
      -> 调用 API 获取已授权账号
      -> 如果只有一个账号，自动选择
      -> 如果有多个账号，询问用户

[3/4] 发布文章...
      -> 解析 Markdown 文件
      -> 提取标题、内容、图片
      -> 调用发布 API
      -> 等待返回结果

[4/4] 报告结果...
      -> 显示发布状态
      -> 提供草稿 ID
      -> 提醒用户手动预览和发布
```

### 3.4 注意事项

1. **API Key 安全**：不要将 .env 文件提交到 Git
2. **公众号授权**：确保公众号在 wx.limyai.com 已完成授权
3. **图片格式**：支持 jpg、png、gif、webp
4. **标题长度**：微信限制标题最多 64 字符

---

## 4. 完整示例

### 4.1 示例 Markdown 文件

文件路径：`~/Documents/ai-tools-review.md`

```markdown
# 2024 年最值得关注的 5 个 AI 工具

![cover](./images/cover.jpg)

人工智能工具在 2024 年迎来了爆发式增长。本文将介绍 5 个最值得关注的 AI 工具。

## 1. Claude：最强对话 AI

**Claude** 由 Anthropic 开发，在长文本理解和代码生成方面表现出色。

> Claude 的上下文窗口高达 200K tokens，可以处理整本书的内容。

主要特点：
- 超长上下文理解
- 出色的推理能力
- 安全可靠

![claude-demo](./images/claude-demo.png)

## 2. Midjourney：AI 绘画领导者

[Midjourney](https://midjourney.com) 是目前最受欢迎的 AI 绘画工具。

![midjourney-example](./images/midjourney.jpg)

## 总结

这些工具正在改变我们的工作方式。选择适合自己的工具，提升效率。
```

### 4.2 执行命令

```
把 ~/Documents/ai-tools-review.md 发布到微信公众号
```

### 4.3 执行结果

Claude 会：

1. **检查 API Key**
2. **获取公众号列表**：
   ```json
   {
     "accounts": [
       {
         "name": "我的公众号",
         "wechatAppid": "wx1234567890",
         "status": "active"
       }
     ]
   }
   ```

3. **发布文章**：
   ```json
   {
     "success": true,
     "data": {
       "publicationId": "xxx",
       "mediaId": "xxx",
       "status": "published",
       "message": "文章已成功发布到公众号草稿箱"
     }
   }
   ```

4. **完成提示**：
   ```
   ✓ 文章已成功发布到公众号草稿箱！

   标题: 2024 年最值得关注的 5 个 AI 工具
   状态: 已保存到草稿箱

   请登录微信公众平台预览并发布。
   ```

---

## 5. 常见问题

### Q1: 如何获取 WECHAT_API_KEY？

A: 访问 [wx.limyai.com](https://wx.limyai.com)，注册账号，授权你的微信公众号，在控制台获取 API Key。

### Q2: 支持哪些平台？

A: 支持 macOS、Linux、Windows。基于 API 的方式无需特殊依赖。

### Q3: 图片上传失败怎么办？

A: 检查以下几点：
- 图片路径是否正确
- 图片格式是否支持（jpg, png, gif, webp）
- 网络连接是否稳定
- 图片大小是否超过限制

### Q4: 可以发布到多个公众号吗？

A: 可以。如果你授权了多个公众号，Skill 会询问你要发布到哪个。

### Q5: news 和 newspic 有什么区别？

A:
- `news`：标准文章格式，支持完整富文本
- `newspic`：小绿书格式，以图片为主，文字有限制

### Q6: 会自动发布文章吗？

A: 不会。文章始终保存为草稿，你需要在公众号后台手动预览和发布。

---

## 6. 更新日志

### v1.0.0 (2025-01)
- 首次发布，支持微信公众号
- 基于 API 发布（无需浏览器自动化）
- 跨平台支持（macOS、Linux、Windows）
- Markdown 自动转换
- 图片自动上传
- 小绿书（newspic）支持
- 仅保存草稿（安全设计）

---

## 附录：项目结构

```
wechat-article-publisher-skill/
├── .claude-plugin/
│   └── plugin.json           # 插件配置
├── skills/
│   └── wechat-article-publisher/
│       ├── SKILL.md          # Skill 核心指令
│       └── scripts/
│           ├── wechat_api.py     # 微信 API 客户端
│           └── parse_markdown.py # Markdown 解析
├── docs/
│   └── GUIDE.md              # 本文档
├── .env.example              # 环境变量模板
├── README.md
└── LICENSE
```

---

## 反馈与贡献

- **GitHub**: https://github.com/iamzifei/wechat-article-publisher-skill
- **Issues**: 遇到问题请提交 Issue
- **PR**: 欢迎贡献代码

---

*本文档最后更新：2025-01*
